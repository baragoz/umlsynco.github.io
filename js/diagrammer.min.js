var dm=function(){return{base:{},menu:{},ds:{},cs:{},hs:{},dm:{},ms:{ctx:{},ds:{}},at:{cs:{created:null,selected:null}}}}(window);window.dm=dm;dm.base=dm.base;dm.menu=dm.menu;dm.ds=dm.ds;dm.cs=dm.cs;dm.es=dm.es;dm.hs=dm.hs;dm.dm=dm.dm;dm.ms=dm.ms;dm.ms.ctx=dm.ms.ctx;dm.at=dm.at;
(function(b,e,j){e.base.convert=function(a){var d={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","#":"&#035;"};return a.replace(/[<>'"#]/g,function(a){return d[a]})};e.base.diagram=function(a,d,c){var l=a.split("."),h="dm."+a;namespace=l[0];a=l[1];c||(c=d,d=e.base.DiagramElement);e=e||{};e[namespace]=e[namespace]||{};e[namespace][a]=function(c,d){if(arguments.length){c=c||{};c.type==j&&(c.type=a);this._createDiagram(c,d)}};var l=new d,f=b.extend(!0,{},l.options);l.options=f;e[namespace][a].prototype=
b.extend(!0,{},l,{namespace:namespace,diagramName:a,diagramEventPrefix:e[namespace][a].prototype.diagramEventPrefix||a,diagramBaseClass:h,inherited:d.prototype.diagramBaseClass},c)};e.base.DiagramElement=function(a,d){arguments.length&&this._createDiagram(a,d)};e.base.DiagramElement.prototype={options:{editable:!0,nameTemplate:"base"},diagramBaseClass:"dm.base.DiagramElement",_createDiagram:function(a,d){this.options=b.extend(!0,{},this.options,a);this.parrent=d;this.euid=this.options.type+e.ds.diagram.ec;
this.options.name==j&&(this.options.name=this.options.nameTemplate+e.ds.diagram.ec);e.ds.diagram.ec++;this._create();(this.element=b(this.element))?(b(this.element).data(this.euid,this),this._baseinit(),b(this.element).bind("remove."+this.euid,this,function(a){a.data.destroy()}),this._init()):alert("Please, declare method _create() for diagram element "+this.euid)},getDescription:function(a,d){var c=!(a||d),l=Object.getPrototypeOf(this),b="{",f="";this._update();for(var g in this.options)if(this.options[g]!=
j)if(l.options[g]!=j){if(l.options[g]!=this.options[g]||"type"==g)b+=f+'"'+g+'":"'+this.options[g]+'"',f=",\n"}else{var e=this.options[g];if(e instanceof Array){var k="",b=b+(f+'"'+g+'":['),f=",",n;for(n in e)if(c||e[n].option(a)==d)b=e[n]&&e[n].getDescription?b+(k+e[n].getDescription()):b+(k+'"'+e[n]+'"'),k=",";b+="]\n"}else"object"!=typeof e&&(b+=f+'"'+g+'":"'+e+'"',f=",\n")}return b+"}"},_update:function(){b.log("_update")},_create:function(){b.log("_create")},_init:function(){b.log("_init")},
_baseinit:function(){b.log("_baseinit")},_destroy:function(){b.log("_destroy")},destroy:function(){this._destroy();this.element.unbind("."+this.euid).removeData(this.euid)},option:function(a,d){var c=a;if(0===arguments.length)return b.extend({},this.options);if("string"===typeof a){if(d===j)return this.options[a];c={};c[a]=d}this._setOptions(c);return this},_setOptions:function(a){for(var d in a)this._setOption(d,a[d])},_setOption:function(a,d){this.options[a]=d}};e.base.diagram("ds.diagram",{options:{nameTemplate:"diagram",
type2:"diagram",editable:!0},_create:function(){this.options.multicanvas?(this.canvasEuid=this.euid+"_Canvas",this.element=b(this.parrent).append('<div id="'+this.euid+'" class="us-diagram" width="100%" height="100%">          <canvas id="'+this.euid+'_Canvas" class="us-canvas" width='+this.options.width+"px height="+this.options.height+'px>          <p>Unfortunately your browser doesn\'t support canvas.</p></canvas>          <div class="us-canvas-bg" style="width:100%;height:100%;">          </div></div>')):
(this.element=b(this.parrent).append('<div id="'+this.euid+'" class="us-diagram" width="100%" height="100%">          <div class="us-canvas-bg" style="width:100%;height:100%;">          </div></div>'),this.canvasEuid="SingleCanvas");this.canvas=window.document.getElementById(this.canvasEuid);this.max_zindex=100;var a=this;b("#"+this.euid+".us-diagram").scroll(function(){a.draw()});var d=this;b("#"+this.euid).dblclick(function(a){a.preventDefault();b.log("DBL CLICK");a.stopPropagation()}).click(function(a){b.log("clicked");
d._setWidgetsOption("selected",false);b("#"+d.euid+" .us-references").hide();d.draw();a.stopPropagation()});this.connectors=[];this.elements=[];this.removedConnectors=[];this.removedElements=[];for(var c in this.options.elements)this.Element(this.options.elements[c].type,this.options.elements[c]);for(c in this.options.connectors)this.options.connectors[c].stored=!0,this.Connector(this.options.connectors[c].type,this.options.connectors[c]);e.dm.loader.OnLoadComplete(function(){for(var a in d.elements){var c=
d.elements[a].options.dropped;if(c){d.elements[a]._dropped={};for(var b in c)for(var j in d.elements)if(d.elements[j].options.id==c[b]){var e=d.elements[j].euid;d.elements[a]._dropped[e]=e;break}}}})},_init:function(){},_destroy:function(){if(this.onDestroyObserver)this.onDestroyObserver()},onDestroy:function(a){this.onDestroyObserver=a},Element:function(a,d,c){e.ds.diagram.ec++;var d=d||{},b=this;b.max_zindex++;d["z-index"]=b.max_zindex;d.ctx_menu=d.ctx_menu||"default";e.dm.loader.Element(a,d,this,
function(a){a!=j&&(b.elements[a.euid]=a);c&&c(a)});return d.euid},_setWidgetsOption:function(a,d){if("selected"==a){this.multipleSelection=d;for(var c in this.elements)this.elements[c]._setOption(a,d);for(c in this.connectors)this.connectors[c]._setOption(a,d);this.selectedConnector=this.selectedElement=j}else if("z-index"==a){var l=this.max_zindex,h=j,f=j,g=j;for(c in this.elements){var e=this.elements[c].option(a);this.elements[c].option("selected")?(h=h==j||e<h?e:h,f=f==j||e>f?e:f):g=g==j||e<g?
e:g}if(g==j||h==j)return;b.log("Min Z-INDEX: "+h);e="front"==d?!0:!1;for(c in this.elements)if(this.elements[c].option("selected")){if(e){var k=this.elements[c].option(a)+this.max_zindex-h+1;b.log("new Z-INDEX: "+k+" D: "+this.elements[c].option(a));this.elements[c]._setOption(a,k);k>l&&(l=k)}}else e||(k=this.elements[c].option(a)-g+f+1,b.log("new2 Z-INDEX: "+k+" D: "+this.elements[c].option(a)),this.elements[c]._setOption(a,k),k>l&&(l=k));this.max_zindex=l+1}else{for(c in this.elements)this.elements[c].option("selected")&&
this.elements[c]._setOption(a,d);for(c in this.connectors)this.connectors[c].option("selected")}this.draw()},Connector:function(a,d,c){var l=this;e.dm.loader.Connector(a,d,this,function(a){a!=j&&(l.connectors[a.euid]=a,"ConnectionHelper"!=a.options.toId&&b.log("REPORT: "+a.options.toId+"   FROM : "+a.options.fromId),l.draw(),c&&c(a))})},draw:function(){if(this.canvas){var a=this.canvas.getContext("2d");a.fillStyle="#EEEEEE";a.clearRect(0,0,this.canvas.width,this.canvas.height);if(0<Object.keys(this.connectors).length){for(var d in this.connectors)(a.lineWidth=
1,this.connectors[d].options.linewidth!=j&&(a.lineWidth=this.connectors[d].options.linewidth),this.connectors[d].options.selected)?(a.lineWidth+=2,this.connectors[d].redraw(a,"#43EC28"),a.lineWidth-=2,this.connectors[d].redraw(a)):this.selectedconntector==this.connectors[d]?this.connectors[d].redraw(a,"#43EC28"):this.connectors[d].options.color?this.connectors[d].redraw(a,this.connectors[d].options.color):this.connectors[d].redraw(a);a.lineWidth=1}}},isPointOnLine:function(a,d){if(0<Object.keys(this.connectors).length){if(!0==
this.transformStarted)return this.selectedconntector.TransformTo(a,d),this.draw(),!0;for(var c in this.connectors)if(this.connectors[c].isPointOnLine(a,d))return this.connectors[c]!=this.selectedconntector&&(this.selectedconntector=this.connectors[c],this.draw()),!0}this.selectedconntector!=j&&(this.selectedconntector._showMenu!=j&&this.selectedconntector._showMenu(a,d,!1),this.selectedconntector=j,e.at.cs.mouseover=null,this.draw());return!1}});e.base.diagram("es.element",{options:{drop:!1,nameTemplate:"Element",
width:140,height:200,left:140,top:200,selected:!1,area:"none",ctx_menu:"default",editable:!0},_create:function(){alert("Could not create virtual element !!!")},_update:function(){var a=b("#"+this.euid+"_Border").position();this.options.pageX=a.left;this.options.pageY=a.top;this.options.left=a.left;this.options.top=a.top;this.options.width=b("#"+this.euid+"_Border").width();this.options.height=b("#"+this.euid+"_Border").height();if(this._dropped){this.options.dropped=[];for(var d in this._dropped)this.parrent.elements[d]?
this.options.dropped.push(this.parrent.elements[d].options.id):alert("NOTE FOUND: "+d)}},_init:function(){this.options.height&&(b("#"+this.euid).css("width",this.options.width).css("height",this.options.height),b("#"+this.euid+"_Border").css("width",this.options.width));this.options.top&&b("#"+this.euid).css("top",this.options.top)},_baseinit:function(){var a="";this.options.pageX!=j&&this.options.pageY!=j&&(a=" style='top:"+this.options.pageY+"px;left:"+this.options.pageX+"px;' ");b(this.element).wrap('<div id="'+
this.euid+'_Border"'+a+' class="us-element-border"></div>');this.highlighted=!1;this.refN=0;this.options.references=this.options.references||[];var a=this.options.subdiagrams||this.options.references||{},d;d="<div class='us-references us-list'><ul class='context-menu-3'><li id='reference-new'><a>new reference</a></li></ul></div>";b("#"+this.euid+"_Border").css({position:"absolute"}).css("top",this.options.pageY).css("left",this.options.pageX);b("#"+this.euid+"_Border .ui-resizable-handle").css({visibility:"hidden"});
b("#"+this.euid).click(this,function(){b("#"+element.parrent.euid+" .us-references").hide()}).mouseenter(this,function(a){a=a.data;if(!a.options.selected&&!a.highlighted){a.highlighted=!0;var c=b("#"+this.id+"_Border").css({"border-width":"3px"}),d=c.css("border-left-width");c.css({left:"-="+d,top:"-="+d})}!a.parrent.options.editable&&(a.options.subdiagrams||0!=a.options.references.length)&&b("#"+this.id+"_REF").css({visibility:"visible"})}).mouseleave(this,function(a){a=a.data;if(!a.options.selected&&
a.highlighted){var c=b("#"+this.id+"_Border"),d=c.css("border-left-width");c.css({"border-width":"0px"}).css({left:"+="+d,top:"+="+d});a.highlighted=!1}b("#"+this.id+"_REF").css({visibility:"hidden"})}).append("<img id='"+this.euid+"_REF' title='REFERENCE' src='./images/reference.png' class='us-element-ref' style='z-index:99999;visibility:hidden;'></img>").parent().append(d);for(var c in a)this.addReference({text:a[c]},!0);b("#"+this.euid+"_Border .us-references").hide().click(function(a){a.stopPropagation()});
b("img#"+this.euid+"_REF").attr("title",this.options.subdiagrams).click(this,function(a){var c=a.data,d="none"==b("#"+c.euid+" .us-references").css("display");b("#"+c.parrent.euid+" .us-references").hide();d||(d=b(this).position(),b("#"+c.euid+"_Border .us-references").show().css({top:d.top+20,left:d.left}));a.stopPropagation()});this.options.color&&this._setOption("color",this.options.color);this.options.borderwidth&&this._setOption("borderwidth",this.options.borderwidth);this.options["font-family"]&&
this._setOption("font-family",this.options["font-family"]);this.options["z-index"]&&b("#"+this.euid+"_Border").css("z-index",this.options["z-index"])},addReference:function(a,d){var c;c="reference-"+this.refN;++this.refN;d||this.options.references.push(a.text);var l=a.idx==j?this.refN:a.idx;c=b("<li id='reference'><a id='"+c+"' class='editablefield reference'>"+a.text+"</a><a class='ui-corner-all'><span class='ui-test ui-icon ui-icon-close' style='float:right;'></span></a></li>");l=b("#"+this.euid+
"_Border .us-references ul li:eq("+l+")");c=1==l.length?c.insertAfter(l):c.appendTo("#"+this.euid+"_Border div.us-references ul");c=c.children("A.reference").bind("click",this,function(a){var c=a.data;c.parrent.options.editable||e.dm.fw.loadContent2(c.parrent.parrent,b(this).text());a.stopPropagation()})},_setOption:function(a,d){var c=this.options[a];if(!(this._setOption2!=j&&this._setOption2(a,d)))if("font-color"==a)b("#"+this.euid+"_Border.us-element-border a").css("color",d);else if("left"==a)b("#"+
this.euid+"_Border").css(a,d);else if("top"==a)b("#"+this.euid+"_Border").css(a,d);else if("color"==a)b("#"+this.euid).css("background-color",d||"");else if("borderwidth"==a)b("#"+this.euid).css("border-width",d||"");else if("width"==a)b("#"+this.euid+"_Border").css("width",d);else if("height"==a){if(b("#"+this.euid+"_Border").css("height",d),c&&d!=c){var c=parseInt(d)-parseInt(c),l=0<c?"+="+c:"-="+Math.abs(c);0!=c&&b("#"+this.euid+"_Border .us-element-resizable-area").css("height",l)}}else"font-family"==
a?b("#"+this.euid).css(a,d||""):"selected"==a?d?(b("#"+this.euid+"_Border .ui-resizable-handle").css({visibility:"visible"}),this.highlighted||(c=b("#"+this.euid+"_Border").css({"border-width":"3px"}),l=c.css("border-left-width"),c.css({left:"-="+l,top:"-="+l}),this.highlighted=!0)):(b("#"+this.euid+"_Border .ui-resizable-handle").css({visibility:"hidden"}),this.highlighted&&(c=b("#"+this.euid+"_Border"),l=c.css("border-left-width"),c.css({"border-width":"0px"}).css({left:"+="+l,top:"+="+l})),this.highlighted=
!1):"z-index"==a&&b("#"+this.euid+"_Border ").css(a,d||"");this.options[a]=d}});e.ds.diagram=e.ds.diagram||{};e.ds.diagram.ec=0;e.base.diagram("cs.connector",{options:{selected:!1,nameTemplate:"Connector",ctx_menu:"connector"},addLabel:function(a){var d=this,c=a.lid!=j?a.lid:this.euid+"_l"+this.label_count;a.lid==j&&++this.label_count;b("<div id='"+c+"' class='editablefield' style='position:absolute;z-index:99999;background-color:white;'>"+a.text+"</div>").appendTo("#"+this.parrent.euid).css("left",
a.left).css("top",a.top).mouseenter(function(){d.options.selected=!0;d.parrent.draw();for(var a in d.labels)b(d.labels[a]).addClass("us-connector-hover")}).mouseleave(function(){d.options.selected=!1;d.parrent.draw();for(var a in d.labels)b(d.labels[a]).removeClass("us-connector-hover")})},_setOption:function(a,d){if(d==j)delete this.options[a];else if("epoints"==a)for(var c in d)this.epoints[c][0]=d[c][0],this.epoints[c][1]=d[c][1];else if("labels"==a)for(c in d)this.labels[c].css({left:d[c][0],
top:d[c][1]});else this.options[a]=d},_create:function(){this.epoints=[];var a=this;this.options.epoints!=j&&b.each(this.options.epoints,function(c,d){a.epoints[c]=[];a.epoints[c][0]=parseInt(d[0]);a.epoints[c][1]=parseInt(d[1])});this.label_count=0;this.cleanOnNextTransform=!1;e.at.cs.created={euid:this.euid,from:this.options.fromId,to:this.options.toId};if(this.options.stored){for(var d in this.parrent.elements)if(this.parrent.elements[d].options.id==this.options.fromId&&(this.from=this.parrent.elements[d].euid),
this.parrent.elements[d].options.id==this.options.toId)this.toId=this.parrent.elements[d].euid;if(this.options.epoints)for(d in e.debug=e.debug||{},e.debug[this.euid]=this.options.epoints,this.epoints=[],this.options.epoints)this.epoints[d]={},this.epoints[d][0]=parseInt(this.options.epoints[d][0],10),this.epoints[d][1]=parseInt(this.options.epoints[d][1],10);this.options.fromId=this.from;this.options.toId=this.toId}else this.from=this.options.fromId,this.toId=this.options.toId;this.labels=[];for(d in this.options.labels){var c=
this.options.labels[d];this.addLabel({text:c.name,left:parseInt(c.x),top:parseInt(c.y)})}},_init:function(){},_baseinit:function(){},drawSelected:function(a,d,c){a.beginPath();a.fillStyle=c;a.strokeStyle=c;a.moveTo(d[0][0],d[0][1]);for(c=1;c<d.length;++c)a.lineTo(d[c][0],d[c][1]);a.stroke();a.closePath()},draw:function(){},redraw:function(a,d){var c=d||"rgba(0,0,0,1)";if(a!=j){this.points=this._getConnectionPoints(this.from,this.toId,this.epoints);this.gip=[];for(var b=0;b<this.points.length-1;++b){var e=
this.points[b][1]-this.points[b+1][1],f=this.points[b][0]-this.points[b+1][0];this.gip[b]=Math.sqrt(f*f+e*e)}this.draw(a,this.points,c)}},_getRValue:function(a,d,c){var b=d-a;return 0<b?b>c?a+c:d:a},isPointOnLine:function(a,d){if(this.points==j)return!1;for(var c=0;c<this.epoints.length;++c)if(this.epoints[c][0]-12<a&&this.epoints[c][0]+12>a&&this.epoints[c][1]-12<d&&this.epoints[c][1]+12>d)return e.at.cs.mouseover={euid:this.euid,idx:c},!0;for(c=0;c<this.points.length-1;++c){var b=a-this.points[c][0],
h=d-this.points[c][1],f=this.points[c+1][0]-a,g=this.points[c+1][1]-d,b=Math.sqrt(b*b+h*h),f=Math.sqrt(f*f+g*g);if(0.2>b+f-this.gip[c])return e.at.cs.mouseover={euid:this.euid},!0}return!1},canRemovePoint:function(a,d,c){if(a==j||d==j)return!1;var b=a[0]-d[0],e=a[1]-d[1],f=a[0]-c[0],g=a[1]-c[1],a=d[0]-c[0],d=d[1]-c[1],f=Math.sqrt(f*f+g*g),a=Math.sqrt(a*a+d*d),b=Math.sqrt(b*b+e*e);return 0.5>f+a-b?!0:!1},_getConnectionPoints:function(a,d,c){var l=b("#"+a).position(),e=b("#"+d).position();if(null!=
e){var f=b("#"+a+"_Border").position(),g=b("#"+d+"_Border").position(),m=b("#"+this.parrent.euid).scrollTop(),k=b("#"+this.parrent.euid).scrollLeft();if(c==j||0==c.length)var n=this._getRValue(l.left+f.left,e.left+g.left,b("#"+a).width()),o=this._getRValue(l.top+f.top,e.top+g.top,b("#"+a).height()),a=this._getRValue(e.left+g.left,l.left+f.left,b("#"+d).width()),d=this._getRValue(e.top+g.top,l.top+f.top,b("#"+d).height()),l=[[n+k,o+m],[a+k,d+m]];else{var m=b("#"+this.parrent.euid).scrollTop(),k=b("#"+
this.parrent.euid).scrollLeft(),p=c.length-1,n=this._getRValue(l.left+f.left,c[0][0]-k,b("#"+a).width())+k,o=this._getRValue(l.top+f.top,c[0][1]-m,b("#"+a).height())+m,a=this._getRValue(e.left+g.left,c[p][0]-k,b("#"+d).width())+k,d=this._getRValue(e.top+g.top,c[p][1]-m,b("#"+d).height())+m,k=m=0,l=[];l[0]=[n,o];for(n=1;n<=c.length;++n)l[n]=[c[n-1][0],c[n-1][1]],l[n][0]-=k,l[n][1]-=m;l[c.length+1]=[a,d]}return l}}})})(jQuery,dm);
(function(b,e,j){e.base.diagram("es.class",e.es.element,{options:{nameTemplate:"Class",width:"150px",height:"auto"},_getAux:function(a){var d=[];d.Class="";d.Interface="interface";d.Enumeration="enum";d.Primitive="primitive";d.ORM="ORM";d.ORMComponent="ORMComponent";d.Template=" ";d[j]="";return d[a]||a},addOperation:function(a){if("Enumeration"!=this.options.aux){var d=a.idx==j?this.opN:a.idx,c;c="operation-"+this.opN;++this.opN;this.options.operations.push(a.text);a=b('<li id="operation"><a id="'+
c+'" class="editablefield operation" >'+a.text+"</a></li>");d=b("#"+this.euid+" .us-class-operations .us-sortable li:eq("+d+")");1==d.length?a.insertAfter(d):a.appendTo("#"+this.euid+" .us-class-operations .us-sortable");a=a.children("a");d=a.height();e.base.editable(this,a,!0);a=b("#"+this.euid+" .us-class-operations .us-sortable").sortable("refresh").height();c=b("#"+this.euid+" .us-class-operations").height();a>c&&(b("#"+this.euid+"_Border").height(),b("#"+this.euid+"_Border").height("+="+d),b("#"+
this.euid+" .us-class-operations").height("+="+d),a=b("#"+this.euid+"_Border").height(),this.options.height=a,this.options.height_o+=d)}},addAttribute:function(a){if("Interface"!=this.options.aux){var d;d="attribute-"+this.atrN;++this.atrN;var c=a.idx==j?this.opN:a.idx,a=b('<li id="attribute"><a id="'+d+'" class="editablefield attribute" >'+a.text+"</a></li>"),c=b("#"+this.euid+" .us-class-attributes .us-sortable li:eq("+c+")"),a=1==c.length?a.insertAfter(c):a.appendTo("#"+this.euid+" .us-class-attributes .us-sortable"),
c=a.height(),a=b("#"+this.euid+" .us-class-attributes .us-sortable").sortable("refresh").height();d=b("#"+this.euid+" .us-class-attributes").height();a>d&&(b("#"+this.euid+"_Border .us-class-attributes").height(),b("#"+this.euid+"_Border").height("+="+c),b("#"+this.euid+" .us-class-attributes").height("+="+c),c=b("#"+this.euid+"_Border .us-class-attributes").height(),this.options.height_a=c,this.options.height=b("#"+this.euid+"_Border").height())}},_create:function(){var a="",d="";this.opN=this.atrN=
0;this.options.operations=this.options.operations||[];this.options.attributes=this.options.attributes||[];this.options.aux&&""!=this.options.aux&&(a=this._getAux(this.options.aux),a!=j&&(""!=a&&" "!=a)&&(d="&lt&lt "+a+" &gt&gt"),a="Template"!=this.options.aux?"":"<div id='template' class='editablefield us-class-template'>"+(this.options.template||"T")+"</div>");var c="",e="",h;for(h in this.options.operations)c+='<li id="operation"><a id="operation-'+this.atrN+'" class="editablefield operation">'+
this.options.operations[h]+"</a></li>",this.atrN++;for(h in this.options.attributes)e+='<li id="attribute"><a id="attribute-'+this.opN+'" class="editablefield attribute">'+this.options.attributes[h]+"</a></li>",this.opN++;this.innerHtmlClassInfo='        <div id="'+this.euid+'" class="us-class grElement">'+a+'        <div class="us-class-header">        <a id="name" class="editablefield us-class-name">'+this.options.name+'</a><br>        <a id="aux" class="us-class-aux">'+d+'</a>        </div>        <div class="us-class-attributes"><ul class="us-sortable">'+
e+'</ul></div>        <div class="us-class-operations us-element-resizable-area"><ul class="us-sortable">'+c+"</ul></div>        </div>      ";b("#"+this.parrent.euid).append(this.innerHtmlClassInfo);this.element=b("#"+this.euid)},_init:function(){this._setOptions(this.options);this.attributes=[];this.operations=[]},_setOption2:function(a,d){if("height_o"==a)return b("#"+this.euid+"_Border .us-class-operations").css("height",d),!0;if("height_a"==a){var c=this.options[a];b("#"+this.euid+"_Border .us-class-attributes").css("height",
d);c=parseInt(d)-parseInt(c);if(0!=c){var j=0<c?"+="+c:"-="+Math.abs(c);b("#"+this.euid+"_Border").css("height",j);this.options.height+=c}return!0}"editable"==a&&b("#"+this.euid+" .us-sortable").sortable({disabled:!0==d?!1:!0});return!1},ec:0})})(jQuery,dm);
(function(b,e,j){e.dm.loader=e.dm.loader||null;e.base.loader=function(a){e.dm.loader||(e.dm.loader=new function(){this.working=!1;return{getUrl:function(){return a},_addToLoadQueue:function(a){var c=e.dm.loader;c._loadQueue||(c.working=!1,c._loadQueue=[]);c._loadQueue.push(a);c._process(!1)},_process:function(d){var c=null,j=e.dm.loader;if(!j.working){if(d&&0<j._loadQueue.length||1==j._loadQueue.length&&!j.working)j.working=!0,c=j._loadQueue.shift();if(c){var h=c.callback,f=c.data;c.precondition()?
b.ajax({url:a+c.url,dataType:"script",success:function(){h(f);j.working=!1;j._process(!0)},error:function(){alert("Failed to load: "+a+c.url);j.working=!1;j._process(!0)}}):(h(f),j.working=!1,j._process(!0))}else j.working=!1}},OnLoadComplete:function(a,c){this._addToLoadQueue({url:"",precondition:function(){return!1},callback:function(c){a&&a(c)},data:c})},Diagram:function(a,c,l,h,f){(e.ds==j||e.ds.diagram==j)&&this._addToLoadQueue({url:"./dm/ds/diagram.js",precondition:function(){return!0},callback:function(){},
data:null});var g={},m=l||{};m.type=a;m.base_type=c;g.options=l;g.diagram=a;g.type=c;g.parrent=h;this._addToLoadQueue({url:"/dm/ds/"+c+".js",precondition:function(){return e.ds==j||e.ds[c]==j?!0:!1},callback:function(a){a=new e.ds[a.type](l,h);b.log("NAME: "+h);f&&f(a);return a},data:g})},LoadElement:function(a){e.es==j?alert("You should create diagram instance first !!!"):e.es[a]==j&&this._addToLoadQueue({url:"/dm/es/"+a+".js",precondition:function(){return e.es[a]==j?!0:!1},callback:function(){}})},
Element:function(a,c,b,h){if(e.es==j)alert("You should create diagram instance first !!!");else{var f={};f.options=c;f.type=a;f.diagram=b;this._addToLoadQueue({url:"/dm/es/"+a+".js",precondition:function(){return e.es[a]==j?!0:!1},callback:function(a){a=new e.es[a.type](a.options,a.diagram);h&&h(a)},data:f})}},Connector:function(a,c,b,h){if(e.cs==j)alert("You should create diagram instance first !!!");else{var f={};f.options=c;f.type=a;f.diagram=b;this._addToLoadQueue({url:"./dm/cs/"+a+".js",precondition:function(){return e.cs[a]==
j?!0:!1},callback:function(a){a=new e.cs[a.type](a.options,a.diagram);h!=j&&h(a)},data:f})}}}},e.dm.loader.url=a,e.dm.loader.working=!1);return e.dm.loader};e.base.loader=e.base.loader})(jQuery,dm);
(function(b,e){e.base.diagram("cs.aggregation",e.cs.connector,{draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0]-a[c-1][0],h=a[c][1]-a[c-1][1],f=Math.sqrt(e*e+h*h);if(!(10>f)){var g=h/f,m=e/f,k=a[c][0]-Math.sqrt(75)*m,n=a[c][1]-Math.sqrt(75)*g,e=a[c][0]-Math.sqrt(300)*m,f=a[c][1]-Math.sqrt(300)*g,h=k+10*g/2,o=n-10*m/2,g=k-10*g/2,m=n+10*m/2;b.beginPath();b.fillStyle=d;b.strokeStyle=d;b.moveTo(a[0][0],a[0][1]);for(d=1;d<c;++d)b.lineTo(a[d][0],a[d][1]);b.moveTo(a[c-1][0],a[c-
1][1]);b.lineTo(e,f);b.lineTo(h,o);b.lineTo(a[c][0],a[c][1]);b.lineTo(g,m);b.lineTo(e,f);b.stroke();b.closePath()}}}})})(jQuery,dm);
(function(b,e){e.base.diagram("cs.nested",e.cs.connector,{draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0]-a[c-1][0],h=a[c][1]-a[c-1][1],f=Math.sqrt(e*e+h*h),h=h/f,g=e/f,e=a[c][0]-Math.sqrt(168.75)*g,m=a[c][1]-Math.sqrt(168.75)*h,k=a[c][0]-Math.sqrt(675)*g,n=a[c][1]-Math.sqrt(675)*h,o=e+12*h/2,p=m-12*g/2,q=e-12*h/2,r=m+12*g/2,s=a[c][0]-Math.sqrt(108)*g,t=a[c][1]-Math.sqrt(108)*h,g=a[c][0]-Math.sqrt(432)*g,h=a[c][1]-Math.sqrt(432)*h;b.beginPath();b.fillStyle=d;b.strokeStyle=
d;b.moveTo(a[0][0],a[0][1]);for(i=1;i<c;++i)b.lineTo(a[i][0],a[i][1]);15>f||(b.moveTo(a[c-1][0],a[c-1][1]),b.lineTo(k,n),b.stroke(),b.moveTo(e,m),b.arc(e,m,7.5,0,2*Math.PI,!0),b.moveTo(o,p),b.lineTo(q,r),b.moveTo(s,t),b.lineTo(g,h),b.stroke(),b.closePath())}}})})(jQuery,dm);
(function(b,e){e.base.diagram("cs.composition",e.cs.connector,{draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0]-a[c-1][0],h=a[c][1]-a[c-1][1],f=Math.sqrt(e*e+h*h);if(!(10>f)){var h=h/f,g=e/f,m=a[c][0]-Math.sqrt(75)*g,k=a[c][1]-Math.sqrt(75)*h,e=a[c][0]-Math.sqrt(300)*g,f=a[c][1]-Math.sqrt(300)*h,n=m+10*h/2,o=k-10*g/2,h=m-10*h/2,g=k+10*g/2;b.beginPath();b.fillStyle=d;b.strokeStyle=d;b.moveTo(a[0][0],a[0][1]);for(i=1;i<c;++i)b.lineTo(a[i][0],a[i][1]);b.stroke();b.closePath();
b.beginPath();b.fillStyle=d;b.strokeStyle=d;b.moveTo(a[c-1][0],a[c-1][1]);b.lineTo(e,f);b.lineTo(n,o);b.lineTo(a[c][0],a[c][1]);b.lineTo(h,g);b.lineTo(e,f);b.fill();b.stroke();b.closePath()}}}})})(jQuery,dm);
(function(b,e){e.base.diagram("cs.dependency",e.cs.connector,{dashedLine:function(b,a,d){var c=b[0],b=b[1],e=a[0]-c,h=a[1]-b,a=Math.sqrt(e*e+h*h);if(!(10>a)){var h=h/a,f=e/a,e=5*f,g=5*h,f=3*f,h=3*h;for(i=0;i<a/8;++i)d.moveTo(c,b),d.lineTo(c+e,b+g),c+=f+e,b+=h+g}},draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0],h=a[c][1],f=e-a[c-1][0],g=h-a[c-1][1],c=Math.sqrt(f*f+g*g),g=g/c,m=f/c,k=e-Math.sqrt(75)*m,n=h-Math.sqrt(75)*g;Math.sqrt(300);Math.sqrt(300);f=k+10*g/2;c=n-10*m/2;
g=k-10*g/2;m=n+10*m/2;b.beginPath();b.fillStyle=d;b.strokeStyle=d;for(d=0;d<a.length-1;++d)this.dashedLine(a[d],a[d+1],b);b.moveTo(f,c);b.lineTo(e,h);b.lineTo(g,m);b.stroke();b.closePath()}}})})(jQuery,dm);
(function(b,e){e.base.diagram("cs.realization",e.cs.connector,{dashedLine:function(b,a,d){var c=b[0],b=b[1],e=a[0]-c,h=a[1]-b,a=Math.sqrt(e*e+h*h);if(!(10>a)){var h=h/a,f=e/a,e=5*f,g=5*h,f=3*f,h=3*h;for(i=0;i<a/8;++i)d.moveTo(c,b),d.lineTo(c+e,b+g),c+=f+e,b+=h+g}},draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0],h=a[c][1],f=e-a[c-1][0],g=h-a[c-1][1],c=Math.sqrt(f*f+g*g),m=g/c,k=f/c,f=e-Math.sqrt(75)*k,g=h-Math.sqrt(75)*m;Math.sqrt(300);Math.sqrt(300);var n=f+10*m/2,o=g-10*
k/2,m=f-10*m/2,k=g+10*k/2;b.beginPath();b.fillStyle=d;b.strokeStyle=d;for(d=0;d<a.length-1;++d)this.dashedLine(a[d],a[d+1],b);10>c||(b.moveTo(f,g),b.lineTo(n,o),b.lineTo(e,h),b.lineTo(m,k),b.lineTo(f,g));b.stroke();b.closePath()}}})})(jQuery,dm);(function(b,e){e.base.diagram("ds.base",e.ds.diagram,{diagramName:"BaseDiagram",diagramEventPrefix:"CD",options:{width:1300,height:700,type:"base"},_init:function(){}})})(jQuery,window.dm);
(function(b,e){e.base.diagram("cs.generalization",e.cs.connector,{draw:function(b,a,d){if(!(null==a||2>a.length)){var c=a.length-1,e=a[c][0],h=a[c-1][0],f=a[c][1],g=a[c-1][1],m=e-h,k=f-g,n=Math.sqrt(m*m+k*k);if(!(10>n)){var k=k/n,o=m/n,m=e-Math.sqrt(75)*o,n=f-Math.sqrt(75)*k;Math.sqrt(300);Math.sqrt(300);var p=m+10*k/2,q=n-10*o/2,k=m-10*k/2,o=n+10*o/2;b.beginPath();b.fillStyle=d;b.strokeStyle=d;b.moveTo(a[0][0],a[0][1]);for(i=1;i<c;++i)b.lineTo(a[i][0],a[i][1]);b.moveTo(h,g);b.lineTo(m,n);b.lineTo(p,
q);b.lineTo(e,f);b.lineTo(k,o);b.lineTo(m,n);b.stroke();b.closePath()}}}})})(jQuery,dm);
(function(b,e,j){e.base.diagram("es.package",e.es.element,{options:{nameTemplate:"Package",droppable:!0,acceptdrop:"package",height:"102px"},_update:function(){var a=b("#"+this.euid+"_Border").position();this.options.pageX=a.left;this.options.pageY=a.top;this.options.left=a.left;this.options.top=a.top;this.options.width=b("#"+this.euid+"_Border").width();this.options.height=b("#"+this.euid+"_Border").height();this.options.height_b=b("#"+this.euid+"_Border .us-package-body").height();if(this._dropped)for(i in this.options.dropped=
[],this._dropped)this.options.dropped.push(this.parrent.elements[this._dropped[i]].options.id)},_create:function(){this.innerHtml='<div id="'+this.euid+'" class="us-package">                                <div class="us-package-tab grElement"></div>            <div class="us-package-body grElement">'+(this.options.aux!=j?"<a>&lt&lt"+this.options.aux+"&gt&gt</a><br><b>":"")+'<a id="name" class="editablefield">'+this.options.name+"</a></div>                                </div>";b("#"+this.parrent.euid).append(this.innerHtml);
this.element=b("#"+this.euid)},_init:function(){this._setOptions(this.options)},_setOption2:function(a,d){return"color"==a?(b("#"+this.euid+" .us-package-tab").css("background-color",d),b("#"+this.euid+" .us-package-body").css("background-color",d),!0):"borderwidth"==a?(b("#"+this.euid+" .us-package-tab").css("border-width",d),b("#"+this.euid+" .us-package-body").css("border-width",d),!0):"font-family"==a?(b("#"+this.euid).css(a,d),!0):"z-index"==a?(b("#"+this.euid+"_Border ").css(a,d),!0):!1}})})(jQuery,
dm);(function(){})(jQuery,dm);(function(b,e){e.base.diagram("ds.sequence",e.ds.base,{})})(jQuery,dm);
(function(b){dm.base.diagram("es.objinstance",dm.es.element,{options:{nameTemplate:"Object",acceptdrop:"package",top_min:40,height:400,resizable_h:"e-u,e-ul,s-u,w-u,w-ul,sw-u,se-u",axis:"x"},_create:function(){this.innerHtml='<div id="'+this.euid+'" class="us-element-resizable-area" style="width:100%;">                        <div class="us-instance-line"></div>\t                    <div id="'+this.euid+'_NEXT" class="us-instance grElement" style="height:40px;">\t                    <div><a id="name" class="editablefield Name">:'+
this.options.name+"</a></div></div></div>";b("#"+this.parrent.euid).append(this.innerHtml);this.element=b("#"+this.euid)},_init:function(){this.options.height&&b("#"+this.euid).css("width","100%").css("height",this.options.height);this.options.top_min&&b("#"+this.euid+"_Border").css("top",this.options.top_min)},addMethod:function(b){this.options.methods=this.options.methods||[];this.options.methods.push(b+"()")},getAutocomplete:function(){b.log("objinst AUTOCOMPLETE:");b.log("methods"+this.options.methods);
return this.options.methods},getName:function(){this.options.name=""+b("#"+this.euid+" .Name").html();return this.options.name}});dm.base.diagram("es.llport",dm.es.element,{options:{nameTemplate:"LLPort",width:"15px",height:"40px",droppable:!0,resizable_h:"n-ul,s-ul",axis:"y",level:0},_create:function(){this.innerHtml='<div id="'+this.euid+'" class="us-port us-element-resizable-area grElement">\t\t\t\t\t\t</div>';b("#"+this.parrent.euid).append(this.innerHtml);this.element=b("#"+this.euid)},_init:function(){b("#"+
this.euid+"_Border").css("width",this.options.width).css("height",this.options.height).css("left",this.options.left).css("top",this.options.top);this.options["z-index"]&&this._setOption("z-index",this.options["z-index"])},_setOption3:function(e,j){this.options[e]=j;if("color"==e)return b("#"+this.euid).css("background-color",j),!0;if("borderwidth"==e)return b("#"+this.euid).css("border-width",j),!0;if("font-family"==e)return b.log("ff: "+j),b("#"+this.euid).css(e,j),!0;"selected"==e?j?b("#"+this.euid+
"_Border .ui-resizable-handle").css({visibility:"visible"}):b("#"+this.euid+"_Border .ui-resizable-handle").css({visibility:"hidden"}):"z-index"==e&&b("#"+this.euid+"_Border ").css(e,j);return this}});dm.base.diagram("es.lldel",dm.es.element,{options:{nameTemplate:"LLdel",width:"15px",height:"15px",droppable:!0,axis:"y"},_create:function(){this.innerHtml='<img id="'+this.euid+'" class="us-element-resizable-area" src="images/lldel.png">\t\t\t\t\t\t</img>';b("#"+this.parrent.euid).append(this.innerHtml);
this.element=b("#"+this.euid)},_init:function(){b("#"+this.euid+"_Border").css("width",this.options.width).css("height",this.options.height).css("left",this.options.left).css("top",this.options.top);this.options["z-index"]&&this._setOption("z-index",this.options["z-index"])}})})(jQuery);
(function(b,e,j){e.base.diagram("cs.llsequence",e.cs.connector,{draw:function(a,b,c){if(!(null==b||2>b.length)){var e=b.length-1,h=b[e][0],f=b[e-1][0],g=b[e][1],j=b[e-1][1],k=h-f,n=g-j,o=Math.sqrt(k*k+n*n);if(!(10>o)){var n=n/o,p=k/o,k=h-Math.sqrt(75)*p,o=g-Math.sqrt(75)*n;Math.sqrt(300);Math.sqrt(300);var q=k+10*n/2,r=o-10*p/2,n=k-10*n/2,p=o+10*p/2;a.beginPath();a.fillStyle=c;a.strokeStyle=c;a.moveTo(b[0][0],b[0][1]);for(i=1;i<e;++i)a.lineTo(b[i][0],b[i][1]);a.moveTo(f,j);a.lineTo(k,o);a.lineTo(q,
r);a.lineTo(h,g);a.lineTo(n,p);a.lineTo(k,o);a.stroke();a.closePath()}}},_init:function(){this.cleanOnNextTransform=!0},_getConnectionPoints:function(a,d,c){var e=b("#"+a).position(),h=b("#"+d).position(),f=b("#"+a+"_Border").position(),g=b("#"+d+"_Border").position(),m=b("#"+a+"_Border").width()+26,a=b("#"+d+"_Border").width()+26,k=b("#"+this.parrent.euid).scrollLeft();"ConnectionHelper"==d?(k=f.top+40>g.top?f.top+40:g.top,k+=5,f=f.left+m/2+13,g=g.left+10,g=[[f,k],[g,k]]):c==j||0==c.length?(k=f.top>
g.top?f.top:g.top,h1=f.top>g.top?e.top:h.top,k+=h1,g.left>f.left?(f=f.left+m-20,g=g.left):(f=f.left+10,g=g.left+a-20),g=[[f,k+5],[g,k+5]]):(e=c[c.length-1][1],g.left>f.left?(f=f.left+m-20,g=g.left):(f=f.left+10,g=g.left+a-20),g=[[f+k,e+0],[g+k,e+0]]);return g},_updateEPoints:function(a){this.epoints=this.epoints&&0<this.epoints.legth?[[a.position.left,a.position.top]]:[[a.position.left,a.position.top+5]];this.cleanOnNextTransform=!0;this.eppos=0;this.parrent.draw()},addLabel:function(a){this.labels.push(b("<div style='position:absolute;z-index:99999;'>"+
a.text+"</div>").appendTo("#"+this.parrent.euid).css("left",a.left).css("top",a.top))},canRemovePoint:function(){return!0}})})(jQuery,dm);
(function(b,e){e.base.diagram("es.interface",e.es.element,{options:{nameTemplate:"Interface",width:"30px",height:"30px"},_update:function(){var e=b("#"+this.euid+"_Border").position();this.options.pageX=e.left;this.options.pageY=e.top;this.options.width=b("#"+this.euid+"_Border").width();this.options.height=b("#"+this.euid+"_Border").height();e=b("#"+this.euid+" #name").position();this.options.nameX=e.left;this.options.nameY=e.top},_create:function(){this.innerHtml='<div id="'+this.euid+'" style="width:100%;height:100%;">                        <div id="Circle" class="us-interface grElement"></div>                        </div>';
b("#"+this.parrent.euid).append(this.innerHtml);this.element=b("#"+this.euid)},_init:function(){this.options.width=this.options.height;b("#"+this.euid+"_Border").css("width",this.options.width).css("height",this.options.height);b("#"+this.euid+" #Circle").css("width",this.options.width).css("height",this.options.height);this.options["background-color"]&&b("#"+this.euid+" #Circle").css("background-color",this.options["background-color"]);b("#"+this.euid+"_Border").bind("resize","#"+this.euid,function(e){var a=
b(e.data).width(),d=b(e.data).height(),c=a;a>d&&(c=d);b(e.data).children(".us-interface").width(c).height(c)});this.options.left&&b("#"+this.euid+"_Border").css("left",this.options.left);this.options.top&&b("#"+this.euid+"_Border").css("top",this.options.top);this.options.name&&b("<div id='name' style='position:absolute;top:100%;z-index:99999;top:"+this.options.nameY+"px;left:"+this.options.nameX+"px;'>"+this.options.name+"</div>").appendTo("#"+this.euid)},_setOption2:function(){return!1}})})(jQuery,
dm);
